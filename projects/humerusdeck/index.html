<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Humerus Deck | Caixunshiren</title> <meta name="author" content="Jack Xun Cai"/> <meta name="description" content="The humerus deck is a NLP project designed to win Cards Against Humanity."/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light"/> <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üêñ</text></svg>"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://caixunshiren.github.io/projects/humerusdeck/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">Caixunshiren</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/about/">About</a> </li> <li class="nav-item "> <a class="nav-link" href="/misc/">Misc</a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">Projects<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">Resume</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title" style="font: size 20%;"> &gt;. <span class="font-weight-bold" id="typewriter"></span> </h1> <br> <p class="post-description">The humerus deck is a NLP project designed to win Cards Against Humanity.</p> </header> <article> <h1 id="humerus-bot">humerus-bot</h1> <p>The humerus bot is a NLP project designed to <em>win</em> Cards Against Humanity. This repository contains code for the <a href="http://44.235.156.190/#new" target="_blank" rel="noopener noreferrer">humerus bot</a> as well as artefacts/code from prior unsuccessful approaches.</p> <p><code class="language-plaintext highlighter-rouge">Note: to see the uncensored, NSFW version of this readme, please see</code> <a href="https://github.com/UTMIST/Humerus/blob/master/README_nsfw.md" target="_blank" rel="noopener noreferrer">README_NSFW</a></p> <p><img src="https://raw.githubusercontent.com/UTMIST/Humerus/master/assets/clean_humerus_home.png" alt="drawing" width="750"></p> <h2 id="background-information">Background Information</h2> <p><a href="https://cardsagainsthumanity.com/" target="_blank" rel="noopener noreferrer">Cards Against Humanity</a> is a popular humor-based party game where one attempts to select the funniest response (white card) for a given prompt (black card). The person who plays the funniest response ‚Äúwins‚Äù the black card, and the first person to accumulate a predetermined number of black cards wins the overall game.</p> <h3 id="client">Client</h3> <p>An existing cards against humanity implementation, <a href="https://github.com/Lattyware/massivedecks" target="_blank" rel="noopener noreferrer">massive decks</a> was <a href="https://github.com/UTMIST/humerusdecks" target="_blank" rel="noopener noreferrer">forked</a> and modified for game data collection and to integrate with our model backend.</p> <p>This is packaged and deployed with docker on AWS.</p> <p>We used GPT-2 to generate a couple CAH decks for use but they ultimately did not make enough sense for a reasonable game experience.</p> <h3 id="challenges">Challenges</h3> <p>Challenges our team largely concerned deployment [and its associated feasibility]. We didn‚Äôt want to spend a ton of money hosting a large model, not to mention having to keep the runtime under a manageable bound. The cost and runtime constraint were a significant factor in design choices [recall: simple nn vs GPT-2 approach].</p> <p>Another major challenge was figuring out just what makes something funny, and how we can capture that in our bot within allotted resource constraints.</p> <h3 id="servermodel">Server/Model</h3> <h4 id="causual-language-modelling-approach">Causual Language Modelling Approach</h4> <p>Assuming that large causal language models e.g. GPT-2 can reasonably model text semantics and meanings (at least superficially), one may use them to determine a ‚Äúfunnyness score‚Äù.</p> <p>We initially tried to use GPT2 to model the distribution of ‚Äúfunny‚Äù CAH combinations, by fine-tuning GPT2 on a dataset of ‚Äúfunny‚Äù sentences. We expected ‚Äúfunnier‚Äù sentences to have a higher probability under the GPT2 model, so we could take the humor score of a CAH combination to be its log-probability under the model.</p> <p>Two clear benefits of this approach are: (1) the ability to leverage the power and extensive pre-training of GPT2 and (2) the ability to easily pretrain on funny text outside of the CAH distribution. For example, we had planned to fine-tune GPT2 on text scrapped from various humor subreddits (i.e. r/copypasta, r/oneliners, r/Jokes), and apply transfer learning to the CAH problem. However, we encountered major limiting resource constraints with this approach, and thus, chose to adopt the BERT + PCA + simple NN architecture.</p> <h4 id="simple-nn">Simple NN</h4> <p>With resource constraints in mind we then implemented a more lightweight model.</p> <ol> <li>Possible plays (white card + black card combination) are embedded with BERT and then PCA‚Äôd. 69 dimensions turned out to be a good number.</li> <li>As pre-generating all embeddings for all plays would take up too much memory, it is assumed that the PCA matrix will not vary significantly for other plays and so is saved for on-the-fly embedding in deployment.</li> <li>A simple two-layer dense predictive neural net is trained on collected game data.</li> <li>Networks is deployed via a simple flask API</li> </ol> <p>We believe that BERT embeddings would be a good representation of text generated by the black card and white card combinations. However, BERT embeddings are 768 dimensional; since we have 500 white cards, 66 one slot black cards, and 12 two slots black cards, it makes a total more than 3 million combinations of these 768-dimensional embeddings. A neural network that takes in 768-dimensional features input is too big to be implemented on our server and storing them takes a lot of computational resources. For this reason, we turned to PCA to reduce the BERT embeddings into smaller dimension but equally rich text representations. Running PCA on 3 million embeddings is simply infeasible. Hence, we ran PCA on a dataset consists of 33000 combinations from the one-slot black cards and 33000 sample combinations from the two-slot black cards. Using the eigenvector matrix generated from this dataset, we generalize PCA to other combinations.</p> <p><img src="https://raw.githubusercontent.com/UTMIST/Humerus/master/assets/fig1.png" alt="pca_69_dim_image"> We found that reducing the BERT embeddings into 69 dimension keeps 88.6 % of the original representation while being at just about the inflection point of the % variance captured vs num_dimensions graph which is desirable.</p> <p><img src="https://raw.githubusercontent.com/UTMIST/Humerus/master/assets/fig2_1.png" alt="angle_1"> <img src="https://raw.githubusercontent.com/UTMIST/Humerus/master/assets/fig2_2.png" alt="angle_2"> To double check that our PCA works, we plotted a 3-dimensional PCA where each color represents a black card as shown above. Note that 3-dimensional PCA only keeps 21.6 % of the original information but the clusters are already visible, showing that similar meaning sentences do tend to cluster. Overall, the PCA approach looks promising and was therefore deployed in our final bot.</p> <h2 id="results">Results</h2> <p>Here are some example plays <img src="https://raw.githubusercontent.com/UTMIST/Humerus/master/assets/clean_ex_1.png" alt="drawing" width="750"> <img src="https://raw.githubusercontent.com/UTMIST/Humerus/master/assets/clean_ex_2.png" alt="drawing" width="750"> <img src="https://raw.githubusercontent.com/UTMIST/Humerus/master/assets/clean_ex_3.png" alt="drawing" width="750"> <img src="https://raw.githubusercontent.com/UTMIST/Humerus/master/assets/clean_ex_4.png" alt="drawing" width="750"> <img src="https://raw.githubusercontent.com/UTMIST/Humerus/master/assets/clean_ex_5.png" alt="drawing" width="750"></p> <p>Are they funny? Judge for yourself at <a href="https://humerusdecks.com" target="_blank" rel="noopener noreferrer">humerusdecks</a>. By casual playing it seems that the result is funnier than random choice. In fact, some of the plays are <em>surprisingly</em> coherent. But some are pretty awful as well.</p> <h2 id="whats-next">What‚Äôs next</h2> <p>A logical next step for this project would be to benchmark its performance against random choice and other CAH bot implementations. It would also be interesting to compare and contrast the results from our deployed simple nn approach to the GPT-2 bot (or any other large casual language model).</p> <h2 id="file--folder-structure">File &amp; Folder Structure</h2> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.
‚îú‚îÄ‚îÄ data 
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ cah-base-en.deck.json5
‚îú‚îÄ‚îÄ humerusbot
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ bert
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ api.py
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ data
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ models
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ notebooks
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Bert Embeddings.ipynb
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ humerus_prediction.ipynb
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ wordembed_to_bert_translation.ipynb
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ train_script.py
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ utils
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ gpt2
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Humerus_Finetuning.ipynb
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ Training_Huggingface.ipynb
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ utils
‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ CAH-Gen.ipynb
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ requirements.txt
</code></pre></div></div> <h2 id="references">References</h2> <p>Another CAH bot implementation: <a href="https://cpury.github.io/ai-against-humanity/" target="_blank" rel="noopener noreferrer">https://cpury.github.io/ai-against-humanity/</a> GLTR: <a href="http://gltr.io" target="_blank" rel="noopener noreferrer">http://gltr.io/</a> GLTR Paper: [https://arxiv.org/abs/1906.04043][https://arxiv.org/abs/1906.04043]</p> <h3 id="team-members">Team Members</h3> <pre><code class="language-json5">{
        'Alston Lo' : "https://github.com/alstonlo",
        'Brian Chen' : "https://github.com/ihasdapie",
        'Matthew Ao' : "https://github.com/aoruize",
        'Jack Cai' : "https://github.com/caixunshiren",
        'Zoha Rehan' : "https://github.com/zoharehan"
}

</code></pre> </article> </div> <script src="https://unpkg.com/typewriter-effect@latest/dist/core.js"></script> <script type="text/javascript">var app=document.getElementById("typewriter"),typewriter=new Typewriter(app,{loop:!1,delay:75});typewriter.start().typeString("Projects");</script> </div> <footer class="fixed-bottom"> <div class="container mt-0"> ¬© Copyright 2022 Jack Xun Cai. ìÅπ‚ÄøìÅπ  ∞·µâ ∞ </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> </body> </html>